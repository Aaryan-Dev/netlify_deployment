<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Books</title>
  </head>

  <link rel="stylesheet" href="book.css" />

  <body>
    <div id="navbar">
      <a href="../index.html">Sign up</a>
      <a href="../login/login.html">Log in</a>
      <a href="#">Books</a>
    </div>

    <div id="display"></div>
  </body>
</html>

<script>
  let auth = JSON.parse(localStorage.getItem("auth")) || undefined;

  if (auth === undefined) {
    window.location.href = "../login/login.html";
  }

  fetch("https://json-db.onrender.com/books")
    .then((res) => {
      return res.json();
    })
    .then((res) => {
      display(res);
    })
    .then((err) => {});

  //   author: "J. K. Rowling";
  //   book_name: "Harry Potter and the Philosopher's Stone";
  //   borrowed: false;
  //   cost: 1299;
  //   edition: "2021";
  //   genre: "fiction";
  //   image_url: "https://m.media-amazon.com/images/I/5165He67NEL.jpg";
  //   publisher: "Bloomsbury";

  function display(data) {
    console.log(data);

    data.forEach((el, index) => {
      let div = document.createElement("div");
      div.setAttribute("id", "brow");

      let image_url = document.createElement("img");
      image_url.src = el.image_url;

      let author = document.createElement("h2");
      author.innerHTML = el.author;

      let book_name = document.createElement("h3");
      book_name.innerHTML = el.book_name;

      let cost = document.createElement("h4");
      cost.innerHTML = el.cost;

      let edition = document.createElement("h5");
      edition.innerHTML = el.edition;

      let genre = document.createElement("h5");
      genre.innerHTML = el.genre;

      let publisher = document.createElement("h5");
      publisher.innerHTML = el.publisher;

      let borrow = document.createElement("button");
      borrow.innerHTML = "Borrow";
      borrow.addEventListener("click", () => getIt(index));

      div.append(
        image_url,
        author,
        book_name,
        cost,
        edition,
        genre,
        publisher,
        borrow
      );
      document.querySelector("#display").append(div);
    });
  }

  function getIt(index) {
    console.log(index);
    console.log(auth);

    // document.querySelector("#appended")[index].innerText = "";

    let append_div = document.createElement("div");
    append_div.setAttribute("id", "appended");

    let p = document.createElement("p");
    p.innerHTML = auth.username;

    let p1 = document.createElement("p");
    p1.innerHTML = auth.time;

    let close = document.createElement("button");
    close.innerText = "Close";

    let confirm = document.createElement("button");
    confirm.innerText = "confirm";

    append_div.append(p, p1, close, confirm);

    document.querySelectorAll("#brow")[index].append(append_div);
  }
</script>
